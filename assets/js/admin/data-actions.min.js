(function(b){function a(){var c={page:0,pages:0,total:0,processed:0,action:null,url:null,btnStart:b("#data-action-start"),btnStop:b("#data-action-stop"),progressbar:b("#loadvessel_progressbar"),progressPercent:b("#loadvessel-bar-percent"),progressPercentValue:b("#loadvessel-progressbar-value"),debuglist:b("#loadvessel-debuglist"),doStop:false,init:function(){c.btnStart.click(c.run);c.btnStop.click(c.stop)},run:function(){c.total=0;c.pages=0;c.page=1;c.processed=0;var d=b('input[name="action"]:checked');if(!d.length){alert("need to select action");return}c.action=d.val();c.progressbar.show();c.btnStart.hide();c.btnStop.show();c.doStop=false;c.query()},stop:function(){c.doStop=true},query:function(){b.ajax({url:ajaxurl,dataType:"json",data:{action:c.action,page:c.page},success:function(d){c.pages=d.totalPages;c.total=d.total;c.processed+=d.count;c.updateProgress();if(c.doStop){alert("Stopped");c.stopped();return}if(c.page==c.pages||!d.count){c.finished()}else{c.page++;c.query()}},error:function(){c.stopped();alert("Stopped due to an error")}})},updateProgress:function(){var d=Math.round((c.processed/c.total)*1000)/10+"%";c.progressPercentValue.width(d);c.progressPercent.html(d);b("#loadvessel-debug-successcount").text(c.processed)},stopped:function(){c.btnStart.show();c.btnStop.hide()},finished:function(){c.stopped();alert("Done")}};c.init()}b(document).ready(function(){if(b("#data-actions-settings").length){a()}})})(jQuery);