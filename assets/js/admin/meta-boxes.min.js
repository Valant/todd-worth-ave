jQuery(function(j){var b;var k=j("#vessel_image_gallery");var h=j("#vessel_images_container").find("ul.vessel_images");j(".add_vessel_images").on("click","a",function(p){var o=j(this);p.preventDefault();if(b){b.open();return}b=wp.media.frames.vessel_gallery=wp.media({title:o.data("choose"),button:{text:o.data("update")},states:[new wp.media.controller.Library({title:o.data("choose"),filterable:"all",multiple:true})]});b.on("select",function(){var q=b.state().get("selection");var r=k.val();q.map(function(t){t=t.toJSON();if(t.id){r=r?r+","+t.id:t.id;var s=t.sizes&&t.sizes.thumbnail?t.sizes.thumbnail.url:t.url;h.append('<li class="image" data-attachment_id="'+t.id+'"><img src="'+s+'" /><ul class="actions"><li><a href="#" class="delete" title="'+o.data("delete")+'">'+o.data("text")+"</a></li></ul></li>")}});k.val(r)});b.open()});h.sortable({items:"li.image",cursor:"move",scrollSensitivity:40,forcePlaceholderSize:true,forceHelperSize:false,helper:"clone",opacity:0.65,placeholder:"ya-metabox-sortable-placeholder",start:function(o,p){p.item.css("background-color","#f6f6f6")},stop:function(o,p){p.item.removeAttr("style")},update:function(){var o="";j("#vessel_images_container").find("ul li.image").css("cursor","default").each(function(){var p=j(this).attr("data-attachment_id");o=o+p+","});k.val(o)}});j("#vessel_images_container").on("click","a.delete",function(){j(this).closest("li.image").remove();var o="";j("#vessel_images_container").find("ul li.image").css("cursor","default").each(function(){var p=j(this).attr("data-attachment_id");o=o+p+","});k.val(o);j("#tiptip_holder").removeAttr("style");j("#tiptip_arrow").removeAttr("style");return false});j("#add_video_row").click(function(r){var p=j("#tmpl-video-row").html();var o=0;j("#vessel_video_list tr").each(function(u,t){var s=parseInt(j(t).data("index"));if(s>o){o=s}});o++;var q="__index__";p=p.replace(new RegExp(q,"g"),o);j("#vessel_video_list").append(p);return false});j("#vessel_video_list").on("click",".remove_video_row",function(p){var o=j(this).closest("tr");o.remove();return false});j(document.body).on("ya-init-unit-conversion",function(){j("select.unit-select").each(function(o,p){var q=j(this).val();j(this).data("prevunit",q)});j(".options_group").on("change","select.unit-select",function(r){var p=j(this).closest(".form-field-unit").find(".unit-value");var q=j(this).val();var t=p.val();if(t!=""){var o=j(this).data("prevunit");var s=ya_convert_measurement(t,o,q);if(s){p.val(s)}}j(this).data("prevunit",q)})}).trigger("ya-init-unit-conversion");j(document.body).on("ya-init-tabbed-panels",function(){j("ul.ya-tabs").show();j("ul.ya-tabs a").click(function(p){p.preventDefault();var o=j(this).closest("div.panel-wrap");j("ul.ya-tabs li",o).removeClass("active");j(this).parent().addClass("active");j("div.panel",o).hide();j(j(this).attr("href")).show()});j("div.panel-wrap").each(function(){j(this).find("ul.ya-tabs li").eq(0).find("a").click()})}).trigger("ya-init-tabbed-panels");var l=j("input#LocationLastKnownPoint");j('<div class="clearfix">').insertAfter(l);var c=l.parent();var n=null;var a;var g;var f=j('<div id="last-location-map">').css({width:"430px",height:"430px","margin-top":"30px"}).appendTo(c).hide();var e=false;var m=null;var i=null;function d(){if(m){clearTimeout(m);m=null}if(!l.is(":visible")){m=setTimeout(d,1000);return}if(!e){m=setTimeout(d,300);return}var p=l.val();var o=p.match(/([\-\d\.]+)[\,\s]+([\-\d\.]+)/);if(o.length>1&&p!==n){n=p;f.show();var q={lat:parseFloat(o[1]),lng:parseFloat(o[2])};if(!a){a=new google.maps.Map(document.getElementById("last-location-map"),{center:q,zoom:8})}else{a.setCenter(q)}if(!i){i=new google.maps.Marker({position:q,map:a,title:"",draggable:true,})}else{i.setPosition(q)}}}initLastLocationMap=function(){e=true;g=new google.maps.Geocoder()};j(document).ready(function(){if(googleOptions.mapsKey){j("<script>").prop("defer",true).prop("async",true).attr("src","https://maps.googleapis.com/maps/api/js?key="+googleOptions.mapsKey+"&callback=initLastLocationMap").prependTo("body")}if(l.length){if(l.val()){d()}l.change(function(){d()});var o=null;l.keydown(function(){if(o){clearTimeout(o)}o=setTimeout(d,2000)});l.val("26.082055, -80.126648");d();j("input#LocationLastKnownDate").val("AIS Date May 10, 2016")}})});